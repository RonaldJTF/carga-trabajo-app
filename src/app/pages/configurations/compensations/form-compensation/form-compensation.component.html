<form class="p-0" [formGroup]="formCompensation">
  <div class="field">
    <div  class="flex flex-wrap justify-content-between">
      <div class="flex align-items-center flex-wrap">
        <span class="text-left font-medium w-full md:w-auto">Categoría</span>
      </div>
      <div class="flex align-items-center flex-wrap">
        <button *ngIf="categoriesFormControl.value" pButton pRipple type="button" icon="pi pi-times" class="p-button-rounded p-button-danger p-button-text" pTooltip="Remover" tooltipPosition="bottom" (click)="removeCategory()"></button>
        <button *ngIf="categoriesFormControl.value" pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-secondary p-button-text" pTooltip="Editar" tooltipPosition="bottom" (click)="editCategory(categoriesFormControl.value.id)"></button>
        <button pButton pRipple type="button" icon="pi pi-plus" class="p-button-rounded p-button-success p-button-text" pTooltip="Crear" tooltipPosition="bottom" (click)="createCategory()"></button>
        <button *ngIf="categoryOptions.length" pButton pRipple type="button" icon="pi pi-angle-down" class="p-button-rounded p-button-info p-button-text" label="Categoria" (click)="categoryOptionsOverlayPanel.toggle($event)"></button>
      </div>
    </div>
    <div class="surface-100 border-round">
      <div class="border-round-xl p-3">
        <div *ngIf="categoriesFormControl.value" class="flex align-items-center w-full">
          <div class="flex align-items-center ">
            <div class="flex flex-column">
              <span class="text-500">{{ categoriesFormControl.value.nombre | uppercase }}</span>
              <span class="text-500">{{ categoriesFormControl.value.descripcion | titlecase }}</span>
            </div>
          </div>
        </div>
        <app-go-to-if-not-found *ngIf="!categoriesFormControl.value" [showButton]="false" [message]="MESSAGE.NO_REGISTRO_CATEGORIAS" [imageSize]="IMAGE_SIZE.LARGE"></app-go-to-if-not-found>
        <div *ngIf="invalidField('categoria') && controls('categoria')">
          <small class="p-error">Seleccione una categoría para la compensación</small>
        </div>
      </div>
    </div>
  </div>
  <div class="field p-fluid">
    <label htmlFor="nombre" class="font-medium">Nombre</label>
    <input pInputText id="nombre" type="text" aria-describedby="text-help" formControlName="nombre"/>
    <div *ngIf="invalidField('nombre') && controls('nombre')">
      <small class="p-error">Ingresa un usuario</small>
    </div>
  </div>
  <div class="field p-fluid">
    <label htmlFor="descripcion"><span class="font-medium">Descripción</span><span> (opcional)</span></label>
    <textarea id="descripcion" rows="5" cols="30" placeholder="Escribe aquí..." pInputTextarea formControlName="descripcion"></textarea>
  </div>
  <div class="field p-fluid">
    <label class="font-medium" htmlFor="idPeriodicidad">Periodicidad</label>
    <p-dropdown id="idPeriodicidad"
                inputId="idPeriodicidad"
                [autoDisplayFirst]="false"
                [options]="periodicity"
                optionValue="id"
                optionLabel="nombre"
                [filter]="true"
                [showClear]="true"
                formControlName="idPeriodicidad"
                [placeholder]="MESSAGE.SELECCIONA_OPCION"
                [emptyMessage]="MESSAGE.NO_REGISTROS"
                [emptyFilterMessage]="MESSAGE.NO_REGISTROS">
    </p-dropdown>
    <div *ngIf="invalidField('idPeriodicidad') && controls('idPeriodicidad')">
      <small class="p-error">Seleccione una periodicidad</small>
    </div>
  </div>
  <div class="field p-fluid mt-5">
    <div class="grid">
      <label htmlFor="estado" class="font-medium pl-3 mb-2">Estado</label>
      <div class="pl-3">
        <p-inputSwitch id="estado" formControlName="estado"></p-inputSwitch>
      </div>
    </div>
  </div>
  <app-form-action-button [deleting]="deleting"
                          [updateMode]="updateMode"
                          [showDeleteButton]="updateMode"
                          [creatingOrUpdating]="creatingOrUpdating"
                          (cancel)="onCancelCompensation($event)"
                          (delete)="onDeleteCompensation($event)"
                          (createOrUpdate)="onSubmitCompensation($event)"
                          [disabledCreateOrUpdateButton]="formCompensation.invalid">
  </app-form-action-button>
</form>

<p-overlayPanel #categoryOptionsOverlayPanel [showCloseIcon]="true">
  <ng-template pTemplate>
    <p-listbox [options]="categoryOptions" optionLabel="label" [filter]="true" title="Categorías" [emptyMessage]="MESSAGE.NO_REGISTROS" [emptyFilterMessage]="MESSAGE.NO_REGISTROS" [style]="{'max-height':'250px', 'overflow':'auto'}" (onClick)="addCategory($event.value.value)">
      <ng-template let-item pTemplate="item">
        <div class="flex align-items-center gap-2 w-full h-1rem">
          <div>{{ item.label }}</div>
          <button (click)="deleteCategory(item, $event)" pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text z-5 ml-auto" pTooltip="Eliminar" tooltipPosition="bottom"></button>
        </div>
      </ng-template>
    </p-listbox>
  </ng-template>
</p-overlayPanel>
